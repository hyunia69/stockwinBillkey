# 다솜 결제 유형 조회 API 명세서

**문서번호**: WOWTV_DM_D0020101_결제시나리오등록전결제유형프로토콜정의서
**버전**: 1.1
**최종수정일**: 2022-09-04
**작성자**: 최영락

---

## 1. 개요

### 1.1 목적

ARS 전화번호에 상품을 배정하기 전, 해당 전화번호의 결제 유형을 사전 조회하기 위한 API 명세입니다.

### 1.2 통신 규약

| 항목 | 값 |
|------|-----|
| 프로토콜 | HTTP 1.1 |
| 방식 | RESTful API |
| 인코딩 | UTF-8 |
| 응답 형식 | Plain Text (구분자: `\|`) |

### 1.3 서비스 흐름

```
[한국경제TV 상품관리]
        │
        ▼ (1) 결제 유형 조회 요청
[페이엠솔루션 ARS 시스템]
        │
        ▼ (2) 전화번호별 결제 유형 반환
[한국경제TV 상품관리]
        │
        ▼ (3) 결제 유형에 따라 시나리오 등록 진행
```

---

## 2. API 엔드포인트

### 2.1 운영 서버

| 환경 | URL |
|------|-----|
| LIVE | `http://api.mspay.co.kr/pg/allat/hangunng_get_arstype.php` |

### 2.2 요청 형식

```
{HTTP_METHOD} HTTP://{host}/{resourcepath}?{parameter}
```

---

## 3. 요청 파라미터

### 3.1 파라미터 목록

| No | Parameter | Type | 필수 | 설명 |
|----|-----------|------|------|------|
| 1 | `mode` | Char | O | 결제 모드 식별자<br>• `hangung2^alphago_hankyung` (고정값)<br>  - `hangung2`: 페이엠솔루션 내부 관리용 결제 ID (정기결제용)<br>  - `alphago_hankyung`: 한국경제TV 관리자 ID |
| 2 | `ars_tel_no` | Char | O | 결제용 배당 전화번호<br>• 숫자만 사용<br>• 페이엠솔루션이 배당한 전화번호 |

### 3.2 요청 예시

```
GET http://api.mspay.co.kr/pg/allat/hangunng_get_arstype.php?mode=hangung2^alphago_hankyung&ars_tel_no=16682972
```

---

## 4. 응답

### 4.1 응답 형식

Plain Text, 파이프(`|`) 구분자 사용

```
ars_tel_no|type_cd_list|Error_cd|message
```

### 4.2 응답 필드

| No | Parameter | Type | 설명 |
|----|-----------|------|------|
| 1 | `ars_tel_no` | Char | 요청 시 사용한 ARS 전화번호 |
| 2 | `type_cd_list` | Char | 결제유형 코드 목록<br>• 쉼표(`,`)로 구분된 3자리 코드<br>• 실패 시 빈 값 |
| 3 | `Error_cd` | Char | 결과코드<br>• `0000`: 성공 |
| 4 | `message` | Char | 결과 메시지 |

### 4.3 결제유형 코드 (type_cd_list)

| 코드 | 설명 | 비고 |
|------|------|------|
| `CQS` | 정기결제용 | 자동 CID 인식형 |
| `CIP` | 일반/간편결제용 | 자동 CID 인식 + 휴대폰 번호 입력형 |
| `NDY` | 결제유형 미지정 | 전화번호만 배정된 상태 |
| `COD` | 종목알파고 전용 | 레거시 시나리오 |
| 기타 | 미사용 코드 | 페이엠솔루션 협의 필요 |

### 4.4 응답 예시

**성공 (단일 유형)**:
```
16682972|CQS|0000|결제유형획득에 성공하셨습니다. 여러개의 결제 유형이 배정된 경우, 페이엠솔루션과 협의하시기 바랍니다.
```

**성공 (복수 유형)**:
```
16682972|CQS,CIP|0000|결제유형획득에 성공하셨습니다. 여러개의 결제 유형이 배정된 경우, 페이엠솔루션과 협의하시기 바랍니다.
```

**실패**:
```
16682972||9001|해당 전화번호를 찾을 수 없습니다.
```

---

## 5. 에러 코드

| 코드 | 설명 |
|------|------|
| `0000` | 성공 |
| 기타 | 실패 (message 필드 참조) |

---

## 6. 연동 시 주의사항

### 6.1 복수 결제유형 처리

- 하나의 전화번호에 여러 결제유형이 배정된 경우 존재
- 복수 유형 반환 시 **페이엠솔루션과 사전 협의 필요**
- 미사용 레거시 시나리오 정비 목적으로 메시지 표시 권장

### 6.2 권장 처리 로직

```
IF type_cd_list = "CQS" THEN
    → 정기결제 시나리오 등록 진행
ELSE IF type_cd_list = "CIP" THEN
    → 일반/간편결제 시나리오 등록 진행
ELSE IF type_cd_list = "NDY" THEN
    → 결제유형 미지정, 신규 배정 가능
ELSE IF type_cd_list contains "," THEN
    → 복수 유형 경고 메시지 표시
    → 페이엠솔루션 협의 안내
ELSE
    → 기타 유형: 페이엠솔루션 협의 필요
END IF
```

---

## 7. 관련 API

| API | 용도 |
|-----|------|
| [시나리오 등록 API](./SPEC_DS_REG_SCENARIO.md) | 결제유형 조회 후 시나리오 등록 |

---

## 8. 변경 이력

| 일자 | 내용 | 수정인 |
|------|------|--------|
| 2022-09-03 | 최초 작성 | 최영락 |
