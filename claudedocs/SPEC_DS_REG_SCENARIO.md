# 다솜 결제 시나리오 등록 API 명세서

**문서번호**: WOWTV_DM_D0020101_결제시나리오등록프로토콜정의서
**버전**: 1.1
**최종수정일**: 2022-09-17
**작성자**: 최영락

---

## 1. 개요

### 1.1 목적

한국경제TV 상품 관리 시스템에서 페이엠솔루션 ARS 결제 서비스 시스템에 결제 시나리오를 자동 등록하기 위한 API 명세입니다.

### 1.2 통신 규약

| 항목 | 값 |
|------|-----|
| 프로토콜 | HTTP 1.1 |
| 방식 | RESTful API |
| 인코딩 | UTF-8 |
| 응답 형식 | Plain Text (구분자: `\|`) |

### 1.3 서비스 흐름

```
[한국경제TV 상품관리]
        │
        ▼ (1) 상품 등록 요청
[페이엠솔루션 ARS 시스템]
        │
        ▼ (2) 시나리오 등록 결과 반환
[한국경제TV 상품관리]
        │
        ▼ (3) 성공 시에만 상품 등록 처리
```

---

## 2. API 엔드포인트

### 2.1 운영 서버

| 환경 | URL |
|------|-----|
| LIVE | `http://api.mspay.co.kr/pg/allat/hangung_item_update.php` |

### 2.2 요청 형식

```
{HTTP_METHOD} HTTP://{host}/{resourcepath}?{parameter}
```

---

## 3. 요청 파라미터

### 3.1 필수 파라미터

| No | Parameter | Type | 필수 | 설명 |
|----|-----------|------|------|------|
| 1 | `mode` | Char | O | 결제 모드 식별자<br>• `hangung2^alphago_hankyung` (고정값)<br>  - `hangung2`: 페이엠솔루션 내부 관리용 결제 ID (정기결제용)<br>  - `alphago_hankyung`: 한국경제TV 관리자 ID |
| 2 | `shop_id` | Char | O | PG사 부여 결제 ID (상세: 3.2 참조) |
| 3 | `ars_tel_no` | Char | O | 결제용 배당 전화번호<br>• 숫자만 사용<br>• 동일 전화번호로 동일 유형의 다른 상품 배정 시 사전협의 불필요 |
| 4 | `scenario_type` | Char | O | 시나리오 유형 코드 (상세: 3.3 참조) |
| 5 | `arrribute_type` | Char | O | 시나리오 속성 코드 (상세: 3.4 참조) |
| 6 | `amount` | Char | O | 결제/안내 금액 |
| 8 | `cc_pord_desc` | Char | O | 상품 정보 (상세: 3.5 참조) |

### 3.2 shop_id 유형

| shop_id | 결제 유형 | 설명 |
|---------|----------|------|
| `arsstockwin2` | 정기결제 | 상품별 간편결제 키 발급<br>• 상품 ID 필수 경유 |
| `arsstockwin1` | 간편결제 | 최초 카드정보 입력 후 간편결제 키로 결제<br>• 이후 카드정보 입력 불필요 |
| `arsstockwin` | 일반결제 | 매번 카드정보 입력 후 결제 |

### 3.3 scenario_type 유형

| 코드 | 설명 |
|------|------|
| `CQS` | 정기결제용 / 자동 전화번호 인식<br>• 고객 입력 최소화 시나리오 |
| `CIP` | 수동 전화번호 입력<br>• 고객 전화번호를 시나리오에서 요구 |

### 3.4 arrribute_type 유형

#### 정기결제 속성

| 코드 | 설명 |
|------|------|
| `1MINTHSEAL` | 1개월 할인금액 후 정기결제 |
| `1MONTH` | 1개월 무료체험 후 정기결제 |
| `1WEEK` | 1주일 무료체험 후 정기결제 |
| `2WEEK` | 2주일 무료체험 후 정기결제 |
| `NOFREE` | 무료체험 없는 정기결제 |
| `ADVRESERVD` | 사전예약형 (startdtm 필수) |

#### 일반/간편결제 속성

| 코드 | 설명 |
|------|------|
| `EDUCATION` | 교육형 시나리오 |
| `SERVICE` | 일반 서비스형 |
| `SERVICE_VARS` | 보이는 ARS 연동형 (미사용) |
| `SELECT_MENU` | 파트너 선택형 (레거시) |
| `CONSENT_MENT` | 개인정보 수집 동의형 (레거시) |

### 3.5 cc_pord_desc 형식

```
상품명[^상품코드1^상품코드2]
```

**예시**:
- 단일 상품: `프리미엄종목^PROD001`
- 정기결제 (할인기간 + 정기결제): `골드멤버십^PROD001_TRIAL^PROD001_REG`

> **참고**: 정기결제 시 할인/무료체험 기간과 정규 결제 기간의 상품코드가 다를 수 있음

### 3.6 선택 파라미터

| No | Parameter | Type | 필수 | 설명 |
|----|-----------|------|------|------|
| 7 | `startdtm` | Char | 조건부 | 사전예약 시작일시<br>• `ADVRESERVD` 속성일 때만 필수<br>• 형식: `YYYYMMDDHHMM`<br>• 예: `202209300850`<br>• 금일 이후 일자만 유효 |
| 9 | `alert_show` | Char | N | 경고창 표시 여부<br>• 기본값: `N` |
| 10 | `req_url` | Char | N | 추가 연동용 Restful API URL |
| 11 | `notice_url` | Char | N | 결과 응답 수신용 URL |

---

## 4. 응답

### 4.1 응답 형식

Plain Text, 파이프(`|`) 구분자 사용

```
ars_tel_no|Item_cd|Error_cd|message
```

### 4.2 응답 필드

| No | Parameter | Type | 설명 |
|----|-----------|------|------|
| 1 | `ars_tel_no` | Char | 요청 시 사용한 ARS 전화번호 |
| 2 | `Item_cd` | Char | 상품코드 (존재할 경우만, 빈 값 가능) |
| 3 | `Error_cd` | Char | 결과코드<br>• `0000`: 등록 성공 |
| 4 | `message` | Char | 결과 메시지<br>• `0000` 외: 오류 메시지 표시 권장 |

### 4.3 응답 예시

**성공**:
```
0212345678|PROD001|0000|등록이 완료되었습니다.
```

**실패**:
```
0212345678||9001|상품코드가 중복됩니다.
```

---

## 5. 에러 코드

| 코드 | 설명 |
|------|------|
| `0000` | 성공 |
| 기타 | 실패 (message 필드 참조) |

---

## 6. 연동 시 주의사항

1. **오류 처리**: 오류 상황 감지 시 반드시 페이엠솔루션과 협의하여 오류 제거
2. **정기결제 특성**: 예민한 서비스이므로 긴밀한 협조 필요
3. **완전 자동화 지양**: 결제 사고 예방을 위해 수동 검증 권장
4. **상품코드 관리**: 정기결제용 간편결제 키는 상품별로 부여됨

---

## 7. 변경 이력

| 일자 | 내용 | 수정인 |
|------|------|--------|
| 2022-07-24 | 최초 작성 | 최영락 |
| 2022-09-03 | 최초 일반결제 변경 처리 추가 | 최영락 |
| 2022-09-04 | 결제시나리오속성 추가(사전예약형) | 최영락 |
